# Maintainer: Nicolas Bourdaud <nicolas.bourdaud@mindmaze.ch>
pkgname=("${MINGW_PACKAGE_PREFIX}-mmpack")
pkgbase=mmpack
pkgver=0.3.0
pkgrel=1
pkgdesc="MindMaze package manager
  This package provides the infrastructure for handling the build,
  installation and removal of mmpack software packages."
arch=('x86_64')
url="https://github.com/mmlabs-mindmaze/mmpack"
source=(https://github.com/mmlabs-mindmaze/mmpack/releases/download/${pkgver}/mmpack-${pkgver}.tar.xz)
sha256sums=(e6d7adfdb14a2ecdc41382f834d7ecb3c54084b41371204ca33a9b4a5e2a57d8)

depends=(mingw-w64-x86_64-libyaml
         mingw-w64-x86_64-curl
         mingw-w64-x86_64-libarchive
         mingw-w64-x86_64-libmmlib1
         mingw-w64-x86_64-meson
         mingw-w64-x86_64-python
         mingw-w64-x86_64-python-yaml
         mingw-w64-x86_64-python-urllib3
         mingw-w64-x86_64-python3-pefile
         mingw-w64-x86_64-python-astroid
)

build() {
    cd $pkgbase-$pkgver
    ./autogen.sh
    ./configure \
        --prefix=${MINGW_PREFIX} \
        --build=${MINGW_CHOST} \
        --host=${MINGW_CHOST}

    make
    make DESTDIR=${srcdir}/dest install
}

package_mmpack() {
    groups=('base')
    local instdir=${srcdir}/dest/${MINGW_PREFIX}

    mkdir -p ${pkgdir}/${MINGW_PREFIX}
    cp -rvf ${instdir}/* ${pkgdir}/${MINGW_PREFIX}


}

eval "package_${MINGW_PACKAGE_PREFIX}-mmpack() { package_mmpack; }"
